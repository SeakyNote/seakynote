## 1.Qt升级发现的问题

1. 函数返回值类型问题,如：应返回指针，但返回了bool
2. QString直接与double相加
3. 非标准扩展。QVector及vector "swap trick"使用错误，应写为vector<T>().swap(vec);
4. 非标准扩展。非常量左值引用绑定临时右值问题，按需改成常量左值引用或普通变量
5. 字符串判断为空写成了字符串地址判断为空。(C4130)
6. 非标准扩展。函数形参为引用，但使用了临时右值。
7. 类函数声明中多加了限定名。(C4596)
8. for each in应改为c++ 11 range for形式
9. 函数形参为char*但实参为宏定义字符串(C2664)
10. qDebug最后不应为endl，应改为Qt::endl或不加
11. QFlags&lt;Qt::WindowType&gt;::QFlags构造时不应为int值，而应为枚举值
12. QWheelEvent中x()/y()应改为position().x()/y()；delta()应改为angleDelta.y()

## 2.处理W4警告发现的问题

| 警告类型/编号 | 产生原因                                                     | 推荐解决方案                                             |
| ------------- | ------------------------------------------------------------ | -------------------------------------------------------- |
| C4828         | 编码为非UTF-8模式                                            | 1.改源文件为UTF8 2.屏蔽警告（cmake/pragma)               |
| C4312         | 强制类型转换/可移植性缺陷（此警告检测将 32 位值分配给 64 位指针类型的尝试，例如，将 32 位 int 或 long 强制转换为 64 位指针。 这可能是不安全的转换，即使对于在发生符号扩展时适应 32 位的指针值也是如此。 如果为 64 位指针类型分配负 32 位整数，则符号扩展会导致指针值引用的内存地址与整数的值不同。 仅对 64 位编译目标发出此警告。） | 暂不处理                                                 |
| C4189         | 局部变量初始化却不使用                                       | 删除该局部变量                                           |
| C4100         | 函数定义了形参但未使用                                       | 直接删除形参                                             |
| C4244         | unsigned int 转换为unsigned short 警告                       | 将程序改为兼容类型或者使用显式的强制类型转换             |
| C4127         | 条件表达式是常量                                             | 根据警告推荐改为if constexpr                             |
| C4456         | 同个函数中多次重复声明同名变量                               | 改成不同名或者根据需要只定义一次                         |
| C4702         | 函数体首句直接return导致后续的代码访问不到                   | 根据实际逻辑需要修改                                     |
| C4458         | 同个类中重复声明同名变量                                     | 改成不同的名称或者根据需要只定义一次                     |
| C4701         | 局部变量未初始化                                             | 初始化局部变量                                           |
| C4459         | 定义的局部变量和全局变量重名                                 | 改名或者根据需要只定义一次                               |
| C4005         | define 同名宏重定义                                          | 改名                                                     |
| C4239         | 使用了非标准扩展,如从RADF到RADF &（不允许常量作为左值）      | 常量改成在变量中存储，赋值后传入                         |
| C4251         | dll接口问题（如果类使用 __declspec(dllexport) 或 __declspec(dllimport) 进行标记且作为该类的成员或该类某个基类的成员的非静态数据成员的类的类型未使用 __declspec(dllexport) 或 __declspec(dllimport) 进行标记，则会发生此警告。） | 如正使用调试版本，可忽略4251                             |
| C4715         | 单一if语句导致函数可能无返回值                               | 增加else情况下的返回值                                   |
| C4125         | 十进制转八进制（可能是因为某个非ANSI字符与数字字符（属于ANSI字符）相邻） | ui文件中的{}符号误写成了中文，导致无法翻译，改成英文即可 |
| C4703         | 使用本地指针未初始化                                         | 初始化本地指针                                           |
| C4457         | 函数内部声明的局部变量和形参重名                             | 使用不同的名字或者修改逻辑                               |
| ui控件重名    | vertical spacer重名                                          | 改名                                                     |